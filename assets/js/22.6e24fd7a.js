(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{248:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"ioc-容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ioc-容器","aria-hidden":"true"}},[s._v("#")]),s._v(" IoC 容器")]),s._v(" "),a("h2",{attrs:{id:"介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#介绍","aria-hidden":"true"}},[s._v("#")]),s._v(" 介绍")]),s._v(" "),a("p",[s._v("在理解控制反转( IoC )容器的使用和好处之前，我们需要回过头来了解大型代码库所面临的依赖关系管理问题。")]),s._v(" "),a("h3",{attrs:{id:"无用的抽象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#无用的抽象","aria-hidden":"true"}},[s._v("#")]),s._v(" 无用的抽象")]),s._v(" "),a("p",[s._v("经常会遇到这样的情况，你必须为库创建无用的抽象来管理其生命周期。")]),s._v(" "),a("p",[s._v("例如，为了确保数据库只连接一次，你可以将所有数据库设置代码移动到它自己的文件中(例如 lib/database.js )，然后在应用程序中导入:")]),s._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" knex "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'knex'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" connection "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("knex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  connection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" connection\n\n")])])]),a("p",[s._v("现在，不需要直接使用 knex ，你可以在任何需要的地方使用 lib/database.js 。")]),s._v(" "),a("p",[s._v("这对于单个依赖项来说没有问题，但是随着应用程序的增长，你会发现代码库中有许多这样的文件在增长，这并不理想。")]),s._v(" "),a("h3",{attrs:{id:"依赖关系管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#依赖关系管理","aria-hidden":"true"}},[s._v("#")]),s._v(" 依赖关系管理")]),s._v(" "),a("p",[s._v("大型代码库面临的最大问题之一是依赖关系的管理。")]),s._v(" "),a("p",[s._v("由于依赖项彼此不了解，开发人员必须以某种方式将它们连接在一起。")]),s._v(" "),a("p",[s._v("让我们以存储在 redis 数据库中的会话为例:")]),s._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Session")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("constructor")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("redis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// needs Redis instance")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Redis")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("constructor")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// needs Config instance")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Config")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("constructor")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("configDirectory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// needs config directory path")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])])]),a("p",[s._v("可以看到，会话类依赖于 Redis 类， Redis 类依赖于配置类，等等。")]),s._v(" "),a("p",[s._v("当使用会话类时，我们必须正确地构建它的依赖关系:")]),s._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" config "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("configDirectory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" redis "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Redis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" session "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Session")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])])]),a("p",[s._v("由于依赖项列表可能会根据项目的需求而增加，你可以很快想象这个顺序实例化过程将如何开始失控!")]),s._v(" "),a("p",[s._v("这就是 IoC 容器发挥作用的地方，它负责为你解决依赖关系。")]),s._v(" "),a("h3",{attrs:{id:"痛苦的测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#痛苦的测试","aria-hidden":"true"}},[s._v("#")]),s._v(" 痛苦的测试")]),s._v(" "),a("p",[s._v("当不使用 IoC 容器时，你必须想出不同的方法来模拟依赖关系，或者依赖于像 sinonjs 这样的库。")]),s._v(" "),a("p",[s._v("使用 IoC 容器时，创建 fakes 很简单，因为所有依赖项都是从 IoC 容器解析的，而不是直接从文件系统解析的。")]),s._v(" "),a("h2",{attrs:{id:"绑定依赖关系"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#绑定依赖关系","aria-hidden":"true"}},[s._v("#")]),s._v(" 绑定依赖关系")]),s._v(" "),a("p",[s._v("假设我们想要 Redis 在 IoC 容器中绑定库，确保它知道如何编写自己。")]),s._v(" "),a("blockquote",[a("p",[s._v("IoC 容器其实没什么，控制模块之间的依赖关系是一个相当简单的想法，但是开辟了一个全新的世界。\n第一步是创建 Redis 类，并将所有依赖项定义为构造参数：")])]),s._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Redis")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("constructor")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("Config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" redisConfig "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'redis'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// connect to redis server")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Redis\n")])])]),a("p",[s._v("请注意， Config 是构造函数依赖项，而不是 require 语句。")]),s._v(" "),a("p",[s._v("接下来，让我们将 Redis 类绑定到 IoC 容器 My/Redis ：")]),s._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ioc "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@adonisjs/fold'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" Redis "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./Redis'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ioc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'My/Redis'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" Config "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Adonis/Src/Config'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Redis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("然后我们可以像这样使用 My/Redis 绑定：")]),s._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" redis "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ioc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'My/Redis'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("ol",[a("li",[a("p",[s._v("该 ioc.bind 方法有两个参数：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("绑定的名称(例如 My/Redis )")])]),s._v(" "),a("li",[a("p",[s._v("每次访问绑定时都会执行一个工厂函数，返回绑定的最终值")])])])]),s._v(" "),a("li",[a("p",[s._v("由于我们使用的是 IoC 容器，因此我们会提取任何现有的绑定(例如 Config )并将其传递给 Redis 类。")])]),s._v(" "),a("li",[a("p",[s._v("最后，我们返回一个新的实例Redis，已配置并可供使用。")])])]),s._v(" "),a("h3",{attrs:{id:"单例模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单例模式","aria-hidden":"true"}},[s._v("#")]),s._v(" 单例模式")]),s._v(" "),a("p",[s._v("我们刚刚创建的绑定 "),a("strong",[s._v("My/Redis")]),s._v(" 存在一个这样的问题：")]),s._v(" "),a("p",[s._v("每次我们从 IoC 容器中获取它时，它返回一个新 Redis 实例，然后都会创建一个新的 Redis 服务器连接。")]),s._v(" "),a("p",[s._v("为了解决这个问题，IoC 容器允许你使用单例模式：")]),s._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("ioc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("singleton")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'My/Redis'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" Config "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Adonis/Src/Config'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Redis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("相比于 ioc.bind ，ioc.singleton 会缓存它的第一个返回值，当再次使用 My/Redis 的时候，仍将返回上一个 Redis 实例。")]),s._v(" "),a("h2",{attrs:{id:"解决依赖关系"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决依赖关系","aria-hidden":"true"}},[s._v("#")]),s._v(" 解决依赖关系")]),s._v(" "),a("p",[s._v("只需调用 ioc.use 方法并为其指定命名空间即可：")]),s._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" redis "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ioc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'My/Redis'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("也可以使用 use 全局方法：")]),s._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" redis "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'My/Redis'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("从 IoC 容器解析依赖关系时执行的步骤是：")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("寻找已注册的 Fake 。")])]),s._v(" "),a("li",[a("p",[s._v("接下来，找到实际的绑定。")])]),s._v(" "),a("li",[a("p",[s._v("查找别名，如果找到，重复该绑定过程。")])]),s._v(" "),a("li",[a("p",[s._v("解析为自动加载路径。")])]),s._v(" "),a("li",[a("p",[s._v("回退到 Node.js 原生的 require 方法。")])])]),s._v(" "),a("h3",{attrs:{id:"别名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#别名","aria-hidden":"true"}},[s._v("#")]),s._v(" 别名")]),s._v(" "),a("p",[s._v("由于 IoC 容器绑定必须是唯一的，我们使用以下模式来绑定名称： "),a("strong",[s._v("Project/Scope/Module")]),s._v(" 。")]),s._v(" "),a("p",[s._v("以 "),a("strong",[s._v("Adonis/Src/Config")]),s._v(" 为例：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Adonis 是项目名称(也可能是你公司的名称)")])]),s._v(" "),a("li",[a("p",[s._v("Src 是 Scope ，因为这个绑定是核心的一部分(对于自己的包，我们使用 "),a("strong",[s._v("Addon")]),s._v(" 关键字)")])]),s._v(" "),a("li",[a("p",[s._v("Config 是实际的模块名称")])])]),s._v(" "),a("p",[s._v("由于有时很难记住并输入完整的命名空间，因此 IoC 容器允许你为它们定义别名。")]),s._v(" "),a("p",[s._v("别名是在 start/app.js 文件 aliases 对象中定义的。")]),s._v(" "),a("blockquote",[a("p",[s._v("AdonisJs 预设了一些别名，如 Route ，View ，Model 等。但是，你可以覆盖它们，如下所示。")])]),s._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("aliases"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  MyRoute"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Adonis/Src/Route'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" Route "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'MyRoute'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("h3",{attrs:{id:"自动加载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自动加载","aria-hidden":"true"}},[s._v("#")]),s._v(" 自动加载")]),s._v(" "),a("p",[s._v("你还可以定义一个由 IoC 容器自动加载的目录，而不仅仅是将依赖项绑定到 IoC 容器。")]),s._v(" "),a("p",[s._v("不用担心，它不会从目录中加载所有文件，而是将目录路径视为依赖项解析过程的一部分。")]),s._v(" "),a("p",[s._v("例如，AdonisJs 的 app 的目录定义为 App 命名空间，这意味着你可以 require app 目录中的所有文件而不需要写路径。")]),s._v(" "),a("p",[s._v("例如：")]),s._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FooService")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" FooService\n")])])]),a("p",[s._v("可以被导入")]),s._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" Foo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'App/Services/Foo'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("如果没有自动加载，就不得不像这样导入它：\n"),a("strong",[s._v("require('../../Services/Foo')")]),s._v(" 。")]),s._v(" "),a("p",[s._v("因此，将自动加载视为一种更可读，更一致的方式来处理文件。")]),s._v(" "),a("h2",{attrs:{id:"faq-s"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#faq-s","aria-hidden":"true"}},[s._v("#")]),s._v(" FAQ's")]),s._v(" "),a("ol",[a("li",[s._v("是否必须绑定 IoC 容器内的所有内容？")])]),s._v(" "),a("p",[s._v("不需要。当你想要将 library/module 的设置抽象为它自己的东西时，才应该使用IoC容器绑定。此外，当你想要分发依赖关系并希望它们与 AdonisJs 生态系统一起时，请考虑使用"),a("router-link",{attrs:{to:"/guides/concept/service-provider.html"}},[s._v("服务提供者")]),s._v("。")],1),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("如何模拟绑定？")])]),s._v(" "),a("p",[s._v("因为 AdonisJs 允许你实现 fakes ，所以不需要模拟绑定。了解更多关于"),a("router-link",{attrs:{to:"/guides/testing/fakes.html"}},[s._v("fakes")]),s._v("。")],1),s._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[s._v("如何将npm模块包装为服务提供者？")])]),s._v(" "),a("p",[a("router-link",{attrs:{to:"/guides/concept/service-provider.html"}},[s._v("服务提供者")]),s._v("是完整的指南。")],1)])},[],!1,null,null,null);t.default=e.exports}}]);