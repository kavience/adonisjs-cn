(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{184:function(t,a,s){t.exports=s.p+"assets/img/drive_dlcc3v.c5389a74.gif"},241:function(t,a,s){"use strict";s.r(a);var e=s(0),r=Object(e.a)({},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"文件存储"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#文件存储","aria-hidden":"true"}},[t._v("#")]),t._v(" 文件存储")]),t._v(" "),e("p",[t._v("AdonisJs 拥有一个基于 Flydrive 构建的专用 Drive Provider ，可与 Amazon S3 等本地和远程文件系统进行交互。")]),t._v(" "),e("p",[t._v("在本指南中，我们将学习如何设置和使用云端硬盘提供程序。")]),t._v(" "),e("h2",{attrs:{id:"建立"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#建立","aria-hidden":"true"}},[t._v("#")]),t._v(" 建立")]),t._v(" "),e("p",[t._v("由于默认情况下未安装云端硬盘驱动器，运行以下命令安装：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" adonis "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" @adonisjs/drive\n")])])]),e("p",[t._v("接下来，我们需要在 start/app.js 文件中注册提供程序：")]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" providers "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@adonisjs/drive/providers/DriveProvider'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),e("blockquote",[e("p",[t._v("驱动程序配置保存在 config/drive.js 文件中，该文件是 adonis install 在安装 Drive Provider 时由命令创建的。")])]),t._v(" "),e("h2",{attrs:{id:"可用驱动程序"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#可用驱动程序","aria-hidden":"true"}},[t._v("#")]),t._v(" 可用驱动程序")]),t._v(" "),e("p",[t._v("Drive Provider 随附的默认驱动程序包括：")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("Amazon S3(s3)，需要 aws-sdk 包")])]),t._v(" "),e("li",[e("p",[t._v("DigitalOcean Spaces(spaces)，需要 aws-sdk 包")])]),t._v(" "),e("li",[e("p",[t._v("本地文件系统(local)")])])]),t._v(" "),e("h2",{attrs:{id:"基本例子"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基本例子","aria-hidden":"true"}},[t._v("#")]),t._v(" 基本例子")]),t._v(" "),e("p",[t._v("以下是如何通过 adonis repl 以下方式与本地磁盘进行交互的基本示例：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(184),alt:"drive_dlcc3v"}})]),t._v(" "),e("h2",{attrs:{id:"驱动-api"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#驱动-api","aria-hidden":"true"}},[t._v("#")]),t._v(" 驱动 API")]),t._v(" "),e("p",[t._v("虽然读取和写入等常见操作在驱动程序中保持不变，但驱动器的 API 主要基于你用于与该驱动器的文件系统交互的驱动程序。")]),t._v(" "),e("h4",{attrs:{id:"exists-relativepath"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#exists-relativepath","aria-hidden":"true"}},[t._v("#")]),t._v(" exists(relativePath)")]),t._v(" "),e("p",[t._v("查找文件/目录是否存在：")]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" exists "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" Drive"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("exists")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'unicorn.jpg'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("h4",{attrs:{id:"get-relativepath-encoding-utf-8"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#get-relativepath-encoding-utf-8","aria-hidden":"true"}},[t._v("#")]),t._v(" get(relativePath, encoding = utf-8)")]),t._v(" "),e("p",[t._v("获取文件内容作为缓冲区或字符串：")]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" unicorn "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" Drive"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'unicorn.jpg'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("h4",{attrs:{id:"getstream-relativepath"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#getstream-relativepath","aria-hidden":"true"}},[t._v("#")]),t._v(" getStream(relativePath)")]),t._v(" "),e("p",[t._v("获取文件作为流：")]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[t._v("Drive"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getStream")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello.txt'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("h4",{attrs:{id:"put-relativepath，content，options"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#put-relativepath，content，options","aria-hidden":"true"}},[t._v("#")]),t._v(" put(relativePath，content，options = {})")]),t._v(" "),e("p",[t._v("使用给定内容创建新文件(创建任何缺少的目录)：")]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" Drive"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello.txt'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Buffer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("from")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello world!'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("h4",{attrs:{id:"prepend-relativepath，content，options"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#prepend-relativepath，content，options","aria-hidden":"true"}},[t._v("#")]),t._v(" prepend(relativePath，content，options = {})")]),t._v(" "),e("p",[t._v("将内容预先添加到文件中(如果路径不存在，则创建新文件)：")]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" Drive"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("prepend")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello.txt'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Buffer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("from")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Prepended!'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("p",[t._v("prepend方法仅适用于本地驱动程序。")]),t._v(" "),e("h4",{attrs:{id:"append-relativepath，content，options"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#append-relativepath，content，options","aria-hidden":"true"}},[t._v("#")]),t._v(" append(relativePath，content，options = {})")]),t._v(" "),e("p",[t._v("将内容附加到文件(如果路径不存在，则创建新文件)：")]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" Drive"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello.txt'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Buffer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("from")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Appended!'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("p",[t._v("append方法仅适用于本地驱动程序。")]),t._v(" "),e("h4",{attrs:{id:"删除-relativepath"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#删除-relativepath","aria-hidden":"true"}},[t._v("#")]),t._v(" 删除(relativePath)")]),t._v(" "),e("p",[t._v("删除现有文件：")]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" Drive"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello.txt'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("h4",{attrs:{id:"move-src，dest，options"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#move-src，dest，options","aria-hidden":"true"}},[t._v("#")]),t._v(" move(src，dest，options = {})")]),t._v(" "),e("p",[t._v("将文件从一个目录移动到另一个目录")]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" Drive"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("move")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello.txt'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hi.txt'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("h4",{attrs:{id:"copy-src，dest，options"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#copy-src，dest，options","aria-hidden":"true"}},[t._v("#")]),t._v(" copy(src，dest，options = {})")]),t._v(" "),e("p",[t._v("将文件从一个目录复制到另一个目录")]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" Drive"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("copy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hi.txt'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello.txt'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("h2",{attrs:{id:"s3-spaces-api"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#s3-spaces-api","aria-hidden":"true"}},[t._v("#")]),t._v(" S3 / Spaces API")]),t._v(" "),e("p",[t._v("以下方法仅适用于 s3 和 spaces 驱动程序。")]),t._v(" "),e("h4",{attrs:{id:"getobject-location，params"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#getobject-location，params","aria-hidden":"true"}},[t._v("#")]),t._v(" getObject(location，params)")]),t._v(" "),e("p",[t._v("获取给定文件的 S3 对象(有关 params 信息，请参阅 S3 参数)：")]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" Drive"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("disk")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s3'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getObject")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'unicorn.jpg'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("h4",{attrs:{id:"geturl-location，-bucket"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#geturl-location，-bucket","aria-hidden":"true"}},[t._v("#")]),t._v(" getUrl(location，[bucket])")]),t._v(" "),e("p",[t._v("获取给定文件的 URL (接受可选的替代 bucket 参数)：")]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" url "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Drive"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("disk")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s3'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUrl")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'unicorn.jpg'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("h4",{attrs:{id:"getsignedurl-location，expiry-900，params"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#getsignedurl-location，expiry-900，params","aria-hidden":"true"}},[t._v("#")]),t._v(" getSignedUrl(location，expiry = 900，params)")]),t._v(" "),e("p",[t._v("获取给定文件的签名 URL ( 15 mins 默认设置为到期时间)：")]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" url "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" Drive"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("disk")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s3'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSignedUrl")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'unicorn.jpg'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])},[],!1,null,null,null);a.default=r.exports}}]);