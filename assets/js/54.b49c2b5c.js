(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{222:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置","aria-hidden":"true"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),a("h2",{attrs:{id:"配置提供商"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置提供商","aria-hidden":"true"}},[t._v("#")]),t._v(" 配置提供商")]),t._v(" "),a("p",[t._v("拥有可维护代码库的第一步是找到用于存储应用程序配置的专用位置。")]),t._v(" "),a("p",[t._v("AdonisJs 使用 config 目录，其中所有文件在引导时加载。")]),t._v(" "),a("p",[t._v("你可以通过 Config Provider 访问配置值：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Config "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Config'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" appSecret "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app.appSecret'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("获取配置值，使用 Config.get 该值接受引用表单中所需键的字符串参数 fileName.key 。")]),t._v(" "),a("p",[t._v("你可以使用点表示法获取嵌套的配置值：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Example of a configuration file e.g. database.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'127.0.0.1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// You can retrieve it like so...")]),t._v("\nConfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'database.mysql.host'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("如果你不确定配置中是否定义了密钥，则可以提供第二个参数，该参数将作为默认值返回：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("Config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'database.mysql.host'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'127.0.0.1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("如果要更改内存配置值，请使用 Config.set ：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("Config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'database.mysql.host'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'db.example.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("Config.set 只会更改内存中的值。它不会将新值写入配置文件。")]),t._v(" "),a("h2",{attrs:{id:"环境提供者"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境提供者","aria-hidden":"true"}},[t._v("#")]),t._v(" 环境提供者")]),t._v(" "),a("p",[t._v("构建应用程序时，你可能需要根据运行代码的环境进行不同的配置。")]),t._v(" "),a("p",[t._v("为了满足这一要求， AdonisJs 使用 dotenv 库。")]),t._v(" "),a("p",[t._v("在每个新的 AdonisJs 项目的根目录中，你将找到一个 .env.example 文件。如果你使用 AdonisJs  CLI 安装应用程序，则此文件将自动复制为 .env。否则，你应该手动复制它。")]),t._v(" "),a("p",[t._v(".env 永远不应 将该文件提交给你的源代码管理或与其他人共享。\n该 .env 文件具有简单的 key=value 语法：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v(".ENV\nAPP_SECRET"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("F7op5n9vx1nAkno0DsNgZm5vjNXpOLIq\nDB_HOST"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("127.0.0.1\nDB_USER"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root\n")])])]),a("p",[t._v("你可以使用 Env Provider 访问 env 值：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Env "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Env'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" appSecret "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'APP_SECRET'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("与配置提供程序一样，你可以提供默认值作为第二个参数：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("Env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DB_USER'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'root'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("Env.get 总是返回一个 string。如果你希望某个 Env 值充当布尔值，则需要通过条件相等语句进行检查，如下所示：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" myBoolean "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'MY_BOOLEAN'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'true'")]),t._v("\n")])])]),a("h4",{attrs:{id:"如果不存在所需的环境变量，则引发错误"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如果不存在所需的环境变量，则引发错误","aria-hidden":"true"}},[t._v("#")]),t._v(" 如果不存在所需的环境变量，则引发错误")]),t._v(" "),a("p",[t._v("当你具有运行应用程序所需的环境变量时，Env.getOrFail() 如果未设置所需的变量，则可能会使用此错误。")]),t._v(" "),a("blockquote",[a("p",[t._v("如果你希望应用程序在缺少环境变量时在引导时快速失败，则仅限制从配置文件内部访问环境变量，并且不要在应用程序中的任何其他位置使用 Env Provider 。")])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Env "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Env'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// Throw "Make sure to define APP_SECRET inside .env file."')]),t._v("\nEnv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getOrFail")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'APP_SECRET'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h4",{attrs:{id:"env文件的位置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#env文件的位置","aria-hidden":"true"}},[t._v("#")]),t._v(" .env文件的位置")]),t._v(" "),a("p",[t._v("你可能想要加载其他 .env 文件。")]),t._v(" "),a("p",[t._v("这可以通过使用 ENV_PATH 环境变量来完成：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ENV_PATH")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/user/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env adonis serve\n")])])]),a("h4",{attrs:{id:"禁用-env文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#禁用-env文件","aria-hidden":"true"}},[t._v("#")]),t._v(" 禁用.env文件")]),t._v(" "),a("p",[t._v("你可能希望直接在服务器上使用环境变量，而不是中继到文件。")]),t._v(" "),a("p",[t._v("这可以通过使用 ENV_SILENT 环境变量来完成：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ENV_SILENT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" adonis serve\n")])])]),a("h4",{attrs:{id:"测试环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试环境","aria-hidden":"true"}},[t._v("#")]),t._v(" 测试环境")]),t._v(" "),a("p",[t._v("如果你使用 NODE_ENV 设置为启动应用程序 testing， AdonisJs 将加载你的 .env.testing 文件并将其值合并到你的 .env 文件中。")]),t._v(" "),a("p",[t._v("这在测试代码库时设置不同的凭据非常有用。")])])},[],!1,null,null,null);s.default=e.exports}}]);